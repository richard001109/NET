#  Wireshark å®žéªŒ

æœ¬éƒ¨åˆ†æŒ‰ç…§æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ä»¥åŠåº”ç”¨å±‚è¿›è¡Œåˆ†ç±»ï¼Œå…±æœ‰ 10 ä¸ªå®žéªŒã€‚éœ€è¦ä½¿ç”¨åè®®åˆ†æžè½¯ä»¶ `Wireshark` è¿›è¡Œï¼Œè¯·æ ¹æ®ç®€ä»‹éƒ¨åˆ†è‡ªè¡Œä¸‹è½½å®‰è£…ã€‚

## å‡†å¤‡

è¯·è‡ªè¡ŒæŸ¥æ‰¾æˆ–ä½¿ç”¨å¦‚ä¸‹å‚è€ƒèµ„æ–™ï¼Œäº†è§£ `Wireshark` çš„åŸºæœ¬ä½¿ç”¨ï¼š

- é€‰æ‹©å¯¹å“ªå—ç½‘å¡è¿›è¡Œæ•°æ®åŒ…æ•èŽ·
- å¼€å§‹/åœæ­¢æ•èŽ·
- äº†è§£ `Wireshark` ä¸»è¦çª—å£åŒºåŸŸ
- è®¾ç½®æ•°æ®åŒ…çš„è¿‡æ»¤
- è·Ÿè¸ªæ•°æ®æµ

ðŸŒ å‚è€ƒ

1. [Wiresharkå®˜æ–¹æ–‡æ¡£](https://www.wireshark.org/docs/wsug_html/)
2. [WiresharkæŠ“åŒ…æ–°æ‰‹ä½¿ç”¨æ•™ç¨‹](https://www.cnblogs.com/linyfeng/p/9496126.html)
3. [Troubleshooting with Wireshark](http://file.allitebooks.com/20160907/Troubleshooting with Wireshark.pdf)
4. [The Official Wireshark Certified Network Analyst Study Guide](http://file.allitebooks.com/20150724/Wireshark Network Analysis- The Official Wireshark Certified Network Analyst Study Guide, 2nd Edition.pdf)
5. [Wireshark Network Security](http://file.allitebooks.com/20190315/Wireshark Network Security.pdf)

## æ•°æ®é“¾è·¯å±‚

â€‹		æ•°æ®é“¾è·¯å±‚æ˜¯OSIå‚è€ƒæ¨¡åž‹ä¸­çš„ç¬¬äºŒå±‚ï¼Œä»‹ä¹ŽäºŽç‰©ç†å±‚å’Œç½‘ç»œå±‚ä¹‹é—´ã€‚æ•°æ®é“¾è·¯å±‚åœ¨ç‰©ç†å±‚æä¾›çš„æœåŠ¡çš„åŸºç¡€ä¸Šå‘ç½‘ç»œå±‚æä¾›æœåŠ¡ï¼Œå…¶æœ€åŸºæœ¬çš„æœåŠ¡æ˜¯å°†æºè‡ªç½‘ç»œå±‚æ¥çš„æ•°æ®å¯é åœ°ä¼ è¾“åˆ°ç›¸é‚»èŠ‚ç‚¹çš„ç›®æ ‡æœºç½‘ç»œå±‚ã€‚
![æ•°æ®é“¾è·¯å±‚å›¾ç‰‡](https://img-blog.csdnimg.cn/20201123003749172.png#pic_center)

### å®žä½œä¸€ ç†Ÿæ‚‰ Ethernet å¸§ç»“æž„

ä½¿ç”¨ Wireshark ä»»æ„è¿›è¡ŒæŠ“åŒ…ï¼Œç†Ÿæ‚‰ Ethernet å¸§çš„ç»“æž„ï¼Œå¦‚ï¼šç›®çš„ MACã€æº MACã€ç±»åž‹ã€å­—æ®µç­‰ã€‚

![image-20211210163032176](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211210163032176.png)

>Ethernetå¸§æ ¼å¼åŒ…å«ç›®çš„MACï¼ŒæºMACï¼Œç±»åž‹ï¼Œæ•°æ®ï¼Œæ ¡éªŒå­—æ®µã€‚ä»Žå›¾ä¸­å¯ä»¥çœ‹åˆ°è¯¥å¸§çš„
>
>ç›®çš„MACä¸º`00:74:9c:9f:40:13`ï¼Œ
>
>æºMACä¸º`98:28:a6:0a:c3:be`ã€‚
>
>æ•°æ®çš„ç±»åž‹æ˜¯IPv4ï¼Œå½“æ•°æ®ä¸è¶³43å­—èŠ‚æ—¶ï¼Œå°±ä¼šè¿›è¡Œå¡«å……ï¼Œä½¿ç”¨Paddingè¡¨ç¤ºçš„å¡«å……æ•°æ®ã€‚

**é—®é¢˜**

ä½ ä¼šå‘çŽ° Wireshark å±•çŽ°ç»™æˆ‘ä»¬çš„å¸§ä¸­æ²¡æœ‰æ ¡éªŒå­—æ®µï¼Œè¯·äº†è§£ä¸€ä¸‹åŽŸå› ã€‚

> å¸§æ ¼å¼ä¸­æ—¶åŒ…å«æ ¡éªŒå­—æ®µçš„ï¼Œä½†æ˜¯Wiresharkåœ¨æŠ“åŒ…çš„æ—¶å€™ï¼Œè‡ªåŠ¨å°†æ ¡éªŒå­—æ®µè¿‡æ»¤æŽ‰äº†ï¼Œæ‰€ä»¥Wiresharkå‘æˆ‘ä»¬å±•ç¤ºçš„å¸§ä¸­æ²¡æœ‰æ ¡éªŒå­—æ®µ

### å®žä½œäºŒ äº†è§£å­ç½‘å†…/å¤–é€šä¿¡æ—¶çš„ MAC åœ°å€

1. `ping` ä½ æ—è¾¹çš„è®¡ç®—æœºï¼ˆåŒä¸€å­ç½‘ï¼‰ï¼ŒåŒæ—¶ç”¨ Wireshark æŠ“è¿™äº›åŒ…ï¼ˆå¯ä½¿ç”¨ icmp å…³é”®å­—è¿›è¡Œè¿‡æ»¤ä»¥åˆ©äºŽåˆ†æžï¼‰ï¼Œè®°å½•ä¸€ä¸‹å‘å‡ºå¸§çš„ç›®çš„ MAC åœ°å€ä»¥åŠè¿”å›žå¸§çš„æº MAC åœ°å€æ˜¯å¤šå°‘ï¼Ÿè¿™ä¸ª MAC åœ°å€æ˜¯è°çš„ï¼Ÿ

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://www.pianshen.com/images/633/60a5ba0e1215a8a7a7d3c5b355585aa1.png)

> Destination MAC: `04ï¼šd3ï¼šb0ï¼šf6ï¼š5cï¼še8`(ç›®çš„MAC)
>
> Source MAC:  `b8ï¼š27ï¼šebï¼še3ï¼š2dï¼še7`    ï¼ˆæºMACï¼‰
>
> Destination MACæ˜¯åŒä¸€å­ç½‘å†…å¦ä¸€å°ä¸»æœºçš„ç‰©ç†åœ°å€
>
> Source MACæ˜¯æœ¬æœºçš„ç‰©ç†åœ°å€
>
> PS:æ­¤å¤„æˆªå›¾ä½¿ç”¨çš„æ˜¯ç½‘ä¸Šæˆªå›¾ï¼Œå› ä¸ºæœ¬äººæŠ€æœ¯æœ‰é™ï¼Œå¹¶æœªè§£å†³é˜²ç«å¢™ç­‰é—®é¢˜ï¼Œæ— æ³•å®žçŽ°åŒå­ç½‘ä¸¤å°ä¸»æœºé—´ç›¸äº’pingé€šï¼Œä¸ºæ›´å¥½ä½“çŽ°å®žéªŒç»“æžœï¼Œæ•…ä½¿ç”¨ç½‘ä¸Šæˆªå›¾ï¼Œæ­¤æˆªå›¾æ¥è‡ªæ–‡ç« ï¼š[Wiresharkå®žéªŒâ€”â€”äº†è§£PDU - ç¨‹åºå‘˜å¤§æœ¬è¥ (pianshen.com)](https://www.pianshen.com/article/85782112867/)

2.   ç„¶åŽ `ping qige.io` ï¼ˆæˆ–è€…æœ¬å­ç½‘å¤–çš„ä¸»æœºéƒ½å¯ä»¥ï¼‰ï¼ŒåŒæ—¶ç”¨ Wireshark æŠ“è¿™äº›åŒ…ï¼ˆå¯ icmp è¿‡æ»¤ï¼‰ï¼Œè®°å½•ä¸€ä¸‹å‘å‡ºå¸§çš„ç›®çš„ MAC åœ°å€ä»¥åŠè¿”å›žå¸§çš„æº MAC åœ°å€æ˜¯å¤šå°‘ï¼Ÿè¿™ä¸ª MAC åœ°å€æ˜¯è°çš„ï¼Ÿ

![image-20211210171000823](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211210171000823.png)

> Destination MAC: `00:74:9c:9f:40:13`   
>
> Source MAC: `98:28:a6:0a:c3:be`    
>
> Destination MACæ˜¯é‡åº†äº¤é€šå¤§å­¦ç½‘å…³çš„ç‰©ç†åœ°å€
>
> Source MACæ˜¯æœ¬æœºçš„ç‰©ç†åœ°å€

3. å†æ¬¡ `ping www.cqjtu.edu.cn` ï¼ˆæˆ–è€…æœ¬å­ç½‘å¤–çš„ä¸»æœºéƒ½å¯ä»¥ï¼‰ï¼ŒåŒæ—¶ç”¨ Wireshark æŠ“è¿™äº›åŒ…ï¼ˆå¯ icmp è¿‡æ»¤ï¼‰ï¼Œè®°å½•ä¸€ä¸‹å‘å‡ºå¸§çš„ç›®çš„ MAC åœ°å€ä»¥åŠè¿”å›žå¸§çš„æº MAC åœ°å€åˆæ˜¯å¤šå°‘ï¼Ÿè¿™ä¸ª MAC åœ°å€åˆæ˜¯è°çš„ï¼Ÿ

![image-20211210173151255](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211210173151255.png)

>Destination MAC: `00:74:9c:9f:40:13`   
>
>Source MAC: `98:28:a6:0a:c3:be`   
>
>Destination MACæ˜¯é‡åº†äº¤é€šå¤§å­¦ç½‘å…³çš„ç‰©ç†åœ°å€
>
>Source MACæ˜¯æœ¬æœºçš„ç‰©ç†åœ°å€

> âœŽ **é—®é¢˜**
>
> é€šè¿‡ä»¥ä¸Šçš„å®žéªŒï¼Œä½ ä¼šå‘çŽ°ï¼š
>
> 1. è®¿é—®æœ¬å­ç½‘çš„è®¡ç®—æœºæ—¶ï¼Œç›®çš„ MAC å°±æ˜¯è¯¥ä¸»æœºçš„
> 2. è®¿é—®éžæœ¬å­ç½‘çš„è®¡ç®—æœºæ—¶ï¼Œç›®çš„ MAC æ˜¯ç½‘å…³çš„
>
> è¯·é—®åŽŸå› æ˜¯ä»€ä¹ˆï¼Ÿ
>
> åŽŸå› æ˜¯ç½‘å…³ä½œä¸ºä¸€ä¸ªå­ç½‘çš„å‡ºå…¥å£ï¼Œå½“ä¸€ä¸ªå­ç½‘æƒ³è¦å’Œå¦å¤–ä¸€ä¸ªå­ç½‘è¿›è¡Œé€šä¿¡ï¼Œå°±å¿…é¡»ç»è¿‡ç½‘å…³ï¼Œæ‰èƒ½å¤Ÿå®žçŽ°é€šä¿¡ï¼Œå¯¹äºŽåŒä¸€å­ç½‘ä¸­çš„ç»ˆç«¯è¿›è¡Œé€šä¿¡ï¼Œå®ƒä»¬åªè¦åœ¨å­ç½‘ä¸­æ‰¾åˆ°å¯¹åº”çš„ç›®çš„åœ°å€å°±å¯ä»¥å®žçŽ°é€šä¿¡ï¼Œä¸éœ€è¦ç»è¿‡ç½‘å…³ã€‚


### å®žä½œä¸‰ æŽŒæ¡ ARP è§£æžè¿‡ç¨‹

1. ä¸ºé˜²æ­¢å¹²æ‰°ï¼Œå…ˆä½¿ç”¨ `arp -d *` å‘½ä»¤æ¸…ç©º arp ç¼“å­˜

![image-20211210174851060](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211210174851060.png)

2. `ping` ä½ æ—è¾¹çš„è®¡ç®—æœºï¼ˆåŒä¸€å­ç½‘ï¼‰ï¼ŒåŒæ—¶ç”¨ Wireshark æŠ“è¿™äº›åŒ…ï¼ˆå¯ arp è¿‡æ»¤ï¼‰ï¼ŒæŸ¥çœ‹ ARP è¯·æ±‚çš„æ ¼å¼ä»¥åŠè¯·æ±‚çš„å†…å®¹ï¼Œæ³¨æ„è§‚å¯Ÿè¯¥è¯·æ±‚çš„ç›®çš„ MAC åœ°å€æ˜¯ä»€ä¹ˆã€‚å†æŸ¥çœ‹ä¸€ä¸‹è¯¥è¯·æ±‚çš„å›žåº”ï¼Œæ³¨æ„è§‚å¯Ÿè¯¥å›žåº”çš„æº MAC å’Œç›®çš„ MAC åœ°å€æ˜¯ä»€ä¹ˆã€‚

3. å†æ¬¡ä½¿ç”¨ `arp -d *` å‘½ä»¤æ¸…ç©º arp ç¼“å­˜

4. ç„¶åŽ `ping qige.io` ï¼ˆæˆ–è€…æœ¬å­ç½‘å¤–çš„ä¸»æœºéƒ½å¯ä»¥ï¼‰ï¼ŒåŒæ—¶ç”¨ Wireshark æŠ“è¿™äº›åŒ…ï¼ˆå¯ arp è¿‡æ»¤ï¼‰ã€‚æŸ¥çœ‹è¿™æ¬¡ ARP è¯·æ±‚çš„æ˜¯ä»€ä¹ˆï¼Œæ³¨æ„è§‚å¯Ÿè¯¥è¯·æ±‚æ˜¯è°åœ¨å›žåº”ã€‚

> âœŽ **é—®é¢˜**
>
> é€šè¿‡ä»¥ä¸Šçš„å®žéªŒï¼Œä½ åº”è¯¥ä¼šå‘çŽ°ï¼Œ
>
> 1. ARP è¯·æ±‚éƒ½æ˜¯ä½¿ç”¨å¹¿æ’­æ–¹å¼å‘é€çš„
> 2. å¦‚æžœè®¿é—®çš„æ˜¯æœ¬å­ç½‘çš„ IPï¼Œé‚£ä¹ˆ ARP è§£æžå°†ç›´æŽ¥å¾—åˆ°è¯¥ IP å¯¹åº”çš„ MACï¼›å¦‚æžœè®¿é—®çš„éžæœ¬å­ç½‘çš„ IPï¼Œ é‚£ä¹ˆ ARP è§£æžå°†å¾—åˆ°ç½‘å…³çš„ MACã€‚
>
> è¯·é—®ä¸ºä»€ä¹ˆï¼Ÿ 

